---
icon: fontawesome/solid/wave-square
title: Калибровка Input Shaping
subtitle: Автоматический и ручной подбор шейперов
description: Методики автоматического и ручного подбора шейперов
---

# Калибровка Input Shaping

## Что такое input shaping?

![](./pics/is_how_it_works_dark.png#only-dark)
![](./pics/is_how_it_works_light.png#only-light)

Input Shaping - это алгоритм, который гасит вибрации механики при прихождении поворотов на высоких ускорениях. Это позволяет увеличить ускорения без возникновения дефекта, называющегося эхо.

Суть алгоритма довольно проста. Представьте, что печатающая голова принтера движется по прямой и резко тормозит, как будто бы перед поворотом. Если input shaping выключен, то это торможение вызовет колебания печатающей головы. На деталях это выглядит как эхо после поворотов.

Если включить input shaping, то торможение будет происходить не в одно движение, а в 2 или более. Каждое из них создаст свою вибрацию. Если мы правильно подгадаем смещение этих движений во времени, то несколько получающихся вибраций попадут в противофазу и загасят друг друга. Таким образом печатающая голова не будет колебаться при прохождении поворотов => не будет эхо на высоких ускорениях => можно будет печатать с хорошим качеством при более высоких значениях ускорения.

На изображении выше показан гипертрофировано простой пример. Такая вибрация возникает, когда колеблется что-то одно, наподобие маятника. Из-за простоты этой вибрации, её можно загасить, разделив движение всего-лишь на два более мелких, происходящих через половину периода. Такой шейпер называется ZV и является самым простым.

В реальных 3д принтерах никогда не бывает, чтобы колебалось только что-то одно. Колеблющихся элементов всегда несколько. Чаще всего, у каждого из них своя резонансная частота. Как итог, гасить надо не одну простую по форме вибрацию, а сумму из нескольких, имеющих разные частоты.

К счастью, шейперы гасят вибрации не только на одной частоте, а в некотором диапазоне частот вокруг целевой. У шейпера ZV ширина полосы гашения очень узкая. И, если элементы механики принтера будут резонировать на разных частотах, то такой шейпер загасит вибрации только на одной частоте. Оставшиеся проявятся на деталях в виде, пусть и уменьшившегося, но всё-таки наличествующего эхо. Поэтому придуманы более сложные шейперы. К примеру, шейпер MZV имеет полосу гашения вибраций уже заметно шире, что позволяет поймать им сразу несколько близких по частоте вибраций. А, если элементы конструкции колеблются прям на сильно разных частотах, то есть шейперы типа 2HUMP_EI и 3HUMP_EI, у которых настолько широкая полоса гашения вибраций, что там даже целевую частоту не то чтобы надо как-то особо хорошо подбирать.

![](./pics/is_why_round_corners_dark.png#only-dark)
![](./pics/is_why_round_corners_light.png#only-light)

Ценой использования input shaping'а является снижение детализации. Разделение движений на несколько более мелких, растянутых во времени, приводит к тому, что печатающая голова немного отклоняется от траектории вблизи угла и "срезает" поворот. На деталях это выглядит как скругление углов, то есть снижение детализации. Величина этого скругления непостоянна, и тем выше, чем:

1. "Жирнее" шейпер;
2. Ниже частота шейпера;
3. Выше значение square_corner_velocity или аналогичного параметра, отвечающего за скорость прохождения углов;
4. Выше ускорение.

Таким образом, у калибровки input shaping'а оказывется две задачи. Первая - это подбор как можно более щадящего шейпера на как можно более высокой частоте, но чтобы гасились все вибрации. Вторая - это рассчёт или подбор пары square_corner_velocity - ускорение, при которых скругление углов будет незаметно.