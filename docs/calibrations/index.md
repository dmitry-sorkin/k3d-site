# Как настроить принтер с нуля

<iframe width="900" height="506" src="https://www.youtube.com/embed/doenKnVk0Ec" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## Порядок настройки декартового принтера

К декартовым относятся принтеры, у которых направления движения частей механики ортогональны осям XYZ декартовой системы координат. То есть принтеры с кинематиками Prusa, CoreXY/H-bot, Makerbot, Ultimaker, Markforged, XY/2 и т.п. Для них порядок настроек в общем случае не отличается и может быть поделена на этапы.

### Этап 1. Проверка механики и электроники принтера

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=122)

1. Проверка выставленного на блоке питания напряжения;
2. Проверка механики:
    1. Работоспособность и направление движения осей;
    2. Работоспособность концевиков;
3. Проверка электроники и экструдера:
    1. Работоспособность термисторов и нагревателей;
    2. Работоспособность вентиляторов;
    3. Работоспособность экструдера;

### Этап 2. Прошивка принтера

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=747)

Подавляющее большинство принтеров, к сожалению, либо идут с прошивкой, в которой нет Linear Advance, либо имеют какие-то другие серьезные проблемы, например, запрещено изменение некоторых важных параметров в конфигурации. Печатать на принтере с такой прошивкой нормально не получится, неизбежно будут либо серьезные косяки по качеству, либо серьезные ограничения по скорости. К тому же, придётся учиться обходить эти ограничения специфической настройкой слайсеров. Учитывая всё это, имеет смысл разузнать у сообщества владельцев вашего принтера, есть ли подобные ограничения или косяки в стоковой прошивке. И, если есть, менять её на нормально настроенную сразу, чтобы потом не переучиваться печатать нормально, а также не перепроводить все настройки принтера с нуля. 

Отдельно стоит отметить, что в замене прошивки нет ничего сложного или опасного. Marlin заменяется просто закидыванием 1 файла на SD-карточку и перезагрузкой принтера. Установка "не того" файла в 99% случаев не повредит электронику принтера, можно будет повторно перепрошить, если что-то пойдёт не так. Klipper в большинстве случаев требует не переустановки, а изменения конфигурационного файла. Просто сохраните старый конфигурационный файл перед заменой, и, если что-то пойдёт не так, можно будет его вернуть обратно.

### Этап 3. Калибровка PID

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=935)

[:material-file-document: Отдельная статья по калибровке PID](./pid.md)

Температура и хотэнда, и стола, управляется алгоритмом PID. Если коэффициенты этого алгоритма будут указаны неверно, то нагрев до указанной температуры может занимать много времени, может быть очень сильный "перехлест" по температуре, а также она может нестабильно поддерживаться в простое или при резком изменении теплоотведения (например, при резкой подаче филамента или включении/выключении обдува). Учитывая, что калибровка PID происходит автоматически, логично сделать её как один из первых этапов.

### Этап 4. Калибровка разрешения экструдера

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=1139)

Если разрешение экструдера будет неправильно выставлено, то всё, что связано с величиной, скоростью и ускорениями движения экструдера будет работать неправильно, в том числе Linear/Pressure advance и откаты. Учитывая это, не имеет смысла пропускать калибровку разрешения, так как, если с ним будет проблема, то придётся переделывать все дальнейшие калибровки. 

!!! warning "Калибровка разрешения производится только и исключительно без нагрузки. Проведение калибровки под нагрузкой (через сопла) не всегда, но часто приводит к проблемам"

### Этап 5. Настройка слайсера

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=1385)

Для того, чтобы печатать, нужна специальная программа-слайсер, которая превращает 3D модели в понятный принтеру код. Лучшим выбором сейчас является [PrusaSlicer](https://github.com/prusa3d/PrusaSlicer/releases). Базовые настройки подробно описаны в видео по ссылке выше.

### Калибровка температуры печати

В общем случае не имеет смысла калибровать температуру печати так как для того, чтобы это сделать корректно, требуется специальное оборудование для испытания моделей на прочность. Рядовому пользователю проще будет воспользоваться этой таблицей:

!!! warning "Если у вас в хотэнде тефлоновая трубка идёт до сопла, то максимальная температура хотэнда = 250°C"

| Филамент | Температура хотэнда | Температура стола |
|:-------- |:---------:|:-------:|
| PLA | 210 | 60 |
| PETG | 235 | 75 |
| ABS/ASA | 280-290 | 110 |
| HIPS | 270 | 100 |
| PC | 280-290 | 120 |
| PA12 (Nylon) | 250 | 100 |
| PA6/PA6.6 | 320 | 130 |
| ABS CF/GF | 290 | 110 |
| PA12 CF/GF | 300 | 100-120 | 
| PA6/PA6.6 CF/GF | 320 | 130 |
| PP GF | 280 | 130 |

Важные примечания:

- При печати через стальное закалённое сопло не композитными филаментами можно поднять температуру на 10-15 градусов, если она не выйдет за пределы возможностей принтера;
- PETG лучше не греть выше 250 градусов так как он может заметно поменять свои свойства (станет хрупким);
- Для ABS/ASA/HIPS и подобных материалов производители часто указывают температуру печати 250 градусов. Это устаревшее ограничение, которое тянется из времён, когда практически на всех принтерах стояли термобарьеры со сквозным прохождением трубки до сопла. При использовании современных титановых/биметаллических термобарьеров ограничение в 250 градусов более не актуально, и есть смысл греть эти филаменты сильнее, чтобы они лучше спекались и детали получались прочнее.

### Этап 6. Калибровка стола

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=2805)

Калибровка стола обычно происходит в 2 этапа:

1. Выставление стола в горизонт;
2. Подбор расстояния от сопла до стола.

1 этап обязателен для всех принтеров, кроме тех, у которых стол жестко прикреплён к раме и не может быть выставлен в горизонт никакими методами, кроме регулировки механики осей, а также тех, у которых есть система автоматического выравнивания стола в горизонт (не путать с наличием датчика автоуровня). 2 этап обязателен для всех принтеров без исключения.

### Этап 7. Калибровка Linear/Pressure advance

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=3260)

На данный момент существует несколько способов калибровки Linear/Pressure advance, но в большинство из них значительную ошибку вносит работа алгоритма Input Shaping, если он есть. Но есть 3 метода, которые позволяют проверить LA/PA максимально изолировано от работы других алгоритмов:

- [:material-file-document: Методика из документации Marlin](https://marlinfw.org/tools/lin_advance/k-factor.html);
- [:material-file-document: Методика Дмитрия Соркина (меня)](./la/index.md);
- [:simple-youtube: Методика Виктора Шаповалова](https://youtu.be/p9IKwwKTIFM).

Методика из документации Marlin физически корректна, но не очень удобна и очень сильно зависит от калибровки первого слоя. Так что её использовать не рекомендуется. Остальные две методики, фактически, являются почти одним и тем же, просто мой вариант реализован в виде веб-страницы, а вариант Виктора в виде отдельной программки. Используйте любой на своё усмотрение. 

Калибровку LA/PA обязательно проводить после калибровки разрешения экструдера. При изменении разрешения экструдера калибровку LA/PA надо проводить заново. Также калибровку LA/PA надо проводить заново при смене пластика, значимом изменении температуры хотэнда, смене сопла и смене термобарьера. 

### Этап 8. Калибровка откатов

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=3555)

[:material-file-document: Инструкция и генератор калибровочных моделей](./retractions/index.md)

Калибровку откатов обязательно проводить после калибровки разрешения экструдера. При изменении разрешения экструдера, надо проводить калибровку заново. Не обязательно, но желательно, проводить после калибровки LA/PA, так как она может слегка изменить результат калибровки откатов. Откаты надо калибровать для каждого сочетания филамента, сопла, температуры печати и термобарьера.

### Этап 9. Калибровка потока и ускорений

[:simple-youtube: Этап в гайде по 3D печати](https://youtu.be/doenKnVk0Ec?t=3768)

Существует устаревшая методика калибровки потока через печать кубика в один периметр и замера толщины стенки. Эта методика в целом верна, но слишком нестабильна - дефекты выкладки слоёв, колебание диаметра прутка и т.д. вносят настолько большие искажения в снимаемые значения, что пользоваться ей на данный момент не рекомендуется. Вместо этого предполагается сначала хорошо настроить разрешение экструдера, напечатать показательную тестовую модель и по ней уже откорректировать поток в большую или меньшую сторону. 

Касательно ускорений. Если используется алгоритм Input Shaping, то максимальные ускорения печати чаще всего определяются полученными шейперами. Если этот алгоритм не используется, то проще всего также определить адекватный для себя предел ускорений по тестовой печати, а не делать специальную отдельную калибровку.

Как лучше делать проверочную печать и как интерпретировать полученную модель подробно описано в видео по ссылке выше.

## Порядок настройки дельта-принтеров

Порядок и способ проведения калибровок дельта-принтеров в целом совпадает с таковым у декартовых принтеров, за исключением пары изменений. Так что логично будет не дублировать то же самое, а описать только отличия.

### Автоматическая калибровка геометрических параметров

Самое главное отличие - **вместо** калибровки стола выполняется автоматическая калибровка геометрических параметров дельты. Это делается по-разному в зависимости от прошивки:

=== "Marlin"

    1. Прикрепите датчик автоуровня;
    2. Выполните автопарковку с помощью команды: 
    ``` { .yaml .copy }
    G28
    ```
    3. Запустите автоматическую калибровку дельты с помощью команды:
    ``` { .yaml .copy }
    G33
    ```
    4. Снимите карту высот принтера с помощью команды:
    ``` { .yaml .copy }
    G29
    ```
    5. Сохраните полученные параметры с помощью команды:
    ``` { .yaml .copy }
    M500
    ```

    Важно отметить, что, если на принтере стоит экран типа 12864 или 2004, то все указанные действия можно вызвать из меню принтера, не подключая его к компьютеру. Если стоит какой-либо цветной экран со своей прошивкой, то там тоже должны быть такие команды, но иногда разработчик их не добавляет. В таком случае придётся подключать принтер к компьютеру и вводить команды вручную. Как подключить принтер описано в этапе с калибровкой PID.

=== "Klipper"

    1. Прикрепите датчик автоуровня;
    2. Выполните автопарковку с помощью команды:
    ``` { .yaml .copy }
    G28
    ```
    3. Запустите автоматическую калибровку дельты с помощью команды:
    ``` { .yaml .copy }
    DELTA_CALIBRATE
    ```
    4. Сохраните параметры с помощью команды:
    ``` { .yaml .copy }
    SAVE_CONFIG 
    ```
    5. Выполните автопарковку с помощью команды:
    ``` { .yaml .copy }
    G28
    ```
    6. Снимите карту высот с помощью команды:
    ``` { .yaml .copy }
    BED_MESH_CALIBRATE
    ```
    7. Сохраните параметры с помощью команды:
    ``` { .yaml .copy }
    SAVE_CONFIG 
    ```

### Расширенная калибровка геометрических параметров

!!! note "В прошивке Marlin этой калибровки нет"

Расширенная калибровка геометрических параметров дельта-принтеров в прошивке Klipper выполняется после всех других калибровок и проверок, в том числе после проверочной печати и настройки потока и ускорений по ней. Подробно методика описана в [официальной документации Klipper](https://www.klipper3d.org/Delta_Calibrate.html#enhanced-delta-calibration).